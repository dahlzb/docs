---
title: Linux系统
date: 2024-04-12 17:07:05
permalink: /pages/aa35cc/
---




## Linx系统

 ![Linux目录结构](https://doc.shiyanlou.com/linux_base/4-1.png)



### 常用命令

``` shell
# 列出目录文件
ls
ls /home
# 用较长格式列出文件
ls -l
# 查看所有文件包括隐藏文件
ls -a
# 查看某个目录的完整属性
ls -dl <目录名>
# 显示所有文件大小 a-查看目录内所有文件，s-显示文件大小，S-按文件大小排序，
ls -asSh
# 切换目录
cd /home/shiyanlou
# 创建文件
touch asd.txt fgh.txt
# 创建连续的多个文件
touch love_{1..10}_shiyanlou.txt
# 查找文件
ls *.txt
# 安装软件
sudo apt-get install sysvbanner
```

 Shell 常用通配符： 

| 字符                    | 含义                                       |
| ----------------------- | ------------------------------------------ |
| `*`                     | 匹配 0 或多个字符                          |
| `?`                     | 匹配任意一个字符                           |
| `[list]`                | 匹配 list 中的任意单一字符                 |
| `[^list]`               | 匹配 除 list 中的任意单一字符以外的字符    |
| `[c1-c2]`               | 匹配 c1-c2 中的任意单一字符 如：[0-9][a-z] |
| `{string1,string2,...}` | 匹配 string1 或 string2 (或更多)其一字符串 |
| `{c1..c2}`              | 匹配 c1-c2 中全部字符 如{1..10}            |

### 用户及文件权限管理

#### 二、Linux用户管理

##### 查看用户

``` shell
who
```

| 参数 | 说明                       |
| ---- | -------------------------- |
| `-a` | 打印能打印的全部           |
| `-d` | 打印死掉的进程             |
| `-m` | 同`am i`，`mom likes`      |
| `-q` | 打印当前登录用户数及用户名 |
| `-u` | 打印当前登录用户登录信息   |
| `-r` | 打印运行等级               |

``` shell
# 新建用户
sudo adduser lilei
# 删除用户 --remove-home 删除用户的工作目录，否则保存
sudo deluser lilei --remove-home
# 切换登录用户
su -l lilei
# 注销
exit 或 ctrl + d
# 
# 查看指定用户(lilei)的用户组
groups lilei
# 将用户(lilei)添加到指定用户组(sudo)
sudo usermod -G sudo lilei
# 删除用户组
groupdel 组
```

##### `adduser` 和 `useradd` 的区别是什么

答：`useradd` 只创建用户，不会创建用户密码和工作目录，创建完了需要使用 `passwd ` 去设置新用户的密码。`adduser` 在创建用户的同时，会创建工作目录和密码（提示你设置），做这一系列的操作。其实 `useradd`、`userdel` 这类操作更像是一种命令，执行完了就返回。而 `adduser` 更像是一种程序，需要你输入、确定等一系列操作。

Linux 还有一些关于隐藏权限和特殊权限的内容，想全面了解 Linux 权限管理这部分内容的用户可以通过其它方式学习。

#### 三、Linux文件权限

##### 3.2 变更文件所有者

``` shell
# 变更文件所有者
sudo chown 所有者名 文件名
```

##### 3.3 修改文件权限

每个文件有三组固定的权限，分别对应拥有者，所属用户组，其他用户，**记住这个顺序是固定的**。文件的读写执行对应字母 `rwx`，以二进制表示就是 `111`，用十进制表示就是 `7` 

方式一：二进制数字

``` shell
chmod 600 iphone11
```

方式二：加减赋值操作

``` shell
# 去掉用户组、其它用户、用户的 rwx 权限
chmod gou-rwx iphone11
# 给用户组添加 r 权限
chmod g+r iphone11
```

``g`` 、``o``  、``u``  分别表示 group（用户组）、others（其他用户） 和 user（用户），``+`` 和 ``-`` 分别表示增加和去掉相应的权限。

### 目录结构及文件基本操作

#### 新建

新建空白文件

``` shell
touch test
```

新建目录

使用 `mkdir`（make directories）命令可以创建一个空目录，也可同时指定创建目录的权限属性。 

``` shell
mkdir mydir
```

使用 `-p` 参数，同时创建父目录（如果不存在该父目录），如下我们同时创建一个多级目录（这在安装软件、配置安装路径时非常有用）： 

``` shell
mkdir -p father/son/grandson 
```

需要注意的是，若当前目录已经创建了一个 test 文件，再使用 `mkdir test` 新建同名的文件夹，系统会报错文件已存在。这符合 Linux 一切皆文件的理念。 

若当前目录存在一个 test 文件夹，则 `touch` 命令，则会更改该文件夹的时间戳而不是新建文件。 

#### 复制

复制文件 

将 `test` 文件复制到 `father/son/grandson` 目录中 

``` shell
cp test father/son/grandson
```

复制目录

 要成功复制目录需要加上 `-r` 或者 `-R` 参数，表示递归复制，就是说有点“株连九族”的意思 

``` shell
cp -r father family
```

#### 删除

删除文件

 使用 `rm`（remove files or directories）命令删除一个文件 :

``` shell
rm test
```

强制删除

``` shell
rm -f test
```

删除目录

跟复制目录一样，要删除一个目录，也需要加上 `-r` 或 `-R` 参数：

```bash
rm -r family
```

遇到权限不足删除不了的目录也可以和删除文件一样加上 `-f` 参数：

```bash
rm -rf family
```

#### 移动

移动文件

使用 `mv`（move or rename files）命令移动文件（剪切）。命令格式是 `mv 源目录文件 目的目录`。 

``` shell
mv file1 Documents
```

重命名文件

 `mv` 命令除了能移动文件外，还能给文件重命名。命令格式为 `mv 旧的文件名 新的文件名`。 

``` shell
mv file1 myfile
```

#### 批量重命名

 使用命令 `rename` 来实现，不过它的参数要用 perl 正则表达式。

``rename`` 不是内置命令， 若提示无该命令可以使用 `sudo apt-get install rename` 命令自行安装。

`rename` 是先使用第二个参数的通配符匹配所有后缀为 `.txt` 的文件，然后使用第一个参数提供的正则表达式将匹配的这些文件的 `.txt` 后缀替换为 `.c` 

``` shell
cd /home/shiyanlou/

# 使用通配符批量创建 5 个文件:
touch file{1..5}.txt

# 批量将这 5 个后缀为 .txt 的文本文件重命名为以 .c 为后缀的文件:
rename 's/\.txt/\.c/' *.txt

# 批量将这 5 个文件，文件名和后缀改为大写:
rename 'y/a-z/A-Z/' *.c
```

#### 查看文件

使用 `cat`，`tac` 和 `nl` 命令查看文件

前两个命令都是用来打印文件内容到标准输出（终端），其中 `cat` 为正序显示，`tac` 为倒序显示。

比如要查看 `passwd` 文件 

``` shell
cat passwd
```

可以加上 `-n` 参数显示行号： 

``` shell
cat -n passwd
```

#### 使用 `more` 和 `less` 命令分页查看文件

如果说上面的 `cat` 是用来快速查看一个文件的内容的，那么这个 `more` 和 `less` 就是天生用来"阅读"一个文件的内容的，比如说 man 手册内部就是使用的 `less` 来显示内容。其中 `more` 命令比较简单，只能向一个方向滚动，而 `less` 为基于 `more` 和 `vi` （一个强大的编辑器，我们有单独的课程来让你学习）开发，功能更强大。`less` 的使用基本和 `more` 一致，具体使用请查看 man 手册，这里只介绍 `more` 命令的使用。 

使用 `more` 命令打开 `passwd` 文件：

```bash
more passwd
```

#### 使用 `head` 和 `tail` 命令查看文件

这两个命令，那些性子比较急的人应该会喜欢，因为它们一个是只查看文件的头几行（默认为 10 行，不足 10 行则显示全部）和尾几行。还是拿 passwd 文件举例，比如当我们想要查看最近新增加的用户，那么我们可以查看这个 `/etc/passwd` 文件，不过我们前面也看到了，这个文件里面一大堆乱糟糟的东西，看起来实在费神啊。因为系统新增加一个用户，会将用户的信息添加到 passwd 文件的最后，那么这时候我们就可以使用 `tail` 命令了：

```bash
tail /etc/passwd
```

甚至更直接的只看一行， 加上 `-n` 参数，后面紧跟行数：

```bash
tail -n 1 /etc/passwd
```

关于 `tail` 命令，不得不提的还有它一个很牛的参数 `-f`，这个参数可以实现不停地读取某个文件的内容并显示。这可以让我们动态查看日志，达到实时监视的目的。不过我不会在这门基础课程中介绍它的更多细节，感兴趣的用户可以自己去了解。 

#### 查看文件类型

使用 `file` 命令查看文件的类型：

```bash
file /bin/ls
file shiyanlou.txt
```

与 Windows 不同的是，如果你新建了一个 shiyanlou.txt 文件，Windows 会自动把它识别为文本文件，而 `file` 命令会识别为一个空文件。这个前面我提到过，在 Linux 中文件的类型不是根据文件后缀来判断的。当你在文件里输入内容后才会显示文件类型。 

#### 编辑文件

Vim

### 环境变量

#### 创建变量

使用 `declare` 命令创建一个变量名为 tmp 的变量：

```bash
declare tmp
```

 其实也可以不用 declare 预声明一个变量，直接即用即创建 

使用 `=` 号赋值运算符，将变量 tmp 赋值为 shiyanlou。注意，与其他语言不同的是， Shell 中的赋值操作，`=` 两边不可以输入空格，否则会报错。 

```bash
# 正确的赋值
tmp=shiyanlou

# 错误的赋值
tmp = shiyanlou
```

 读取变量的值，使用 `echo` 命令和 `$` 符号（**$ 符号用于表示引用一个变量的值，初学者经常忘记输入**）： 

``` bash
echo $tmp
```



#### 变量修改

| 变量设置方式                   | 说明                                         |
| ------------------------------ | -------------------------------------------- |
| `${变量名#匹配字串}`           | 从头向后开始匹配，删除符合匹配字串的最短数据 |
| `${变量名##匹配字串}`          | 从头向后开始匹配，删除符合匹配字串的最长数据 |
| `${变量名%匹配字串}`           | 从尾向前开始匹配，删除符合匹配字串的最短数据 |
| `${变量名%%匹配字串}`          | 从尾向前开始匹配，删除符合匹配字串的最长数据 |
| `${变量名/旧的字串/新的字串}`  | 将符合旧字串的第一个字串替换为新的字串       |
| `${变量名//旧的字串/新的字串}` | 将符合旧字串的全部字串替换为新的字串         |

从变量值最后开始匹配删除 `mypath` 变量中的 `/home/shiyanlou/mybin`

``` bash
mypath=${mypath%/home/shiyanlou/mybin}
```



#### 删除变量

可以使用 `unset` 命令删除一个环境变量：

```bash
unset mypath
```



#### 让环境变量生效

前面我们在 Shell 中修改了一个配置脚本文件之后（比如 zsh 的配置文件 home 目录下的 `.zshrc`），每次都要退出终端重新打开甚至重启主机之后其才能生效，很是麻烦，我们可以使用 `source` 命令来让其立即生效，如：

```bash
cd /home/shiyanlou
source .zshrc
```

`source` 命令还有一个别名就是 `.`，上面的命令如果替换成 `.` 的方式就该是：

```bash
. ./.zshrc
```

 在使用 `.` 的时候，需要注意与表示当前路径的那个点区分开。 



### 文件查找

与搜索相关的命令常用的有 `whereis`，`which`，`find` 和 `locate`。

#### whereis 

``` bash
# 查找文件 who 、find
whereis who
whereis find
```

使用 `whereis` 这个搜索很快，因为它并没有从硬盘中依次查找，而是直接从数据库中查询。

`whereis` 只能搜索二进制文件（`-b`），man 帮助文件（`-m`）和源代码文件（`-s`）。

| 命令 | 说明               |
| ---- | ------------------ |
| `-b` | 只搜索二进制文件   |
| `-m` | 只搜索man 帮助文件 |
| `-s` | 只搜索源代码文件   |



#### locate

使用 `locate` 命令查找文件也不会遍历硬盘，它通过查询 `/var/lib/mlocate/mlocate.db` 数据库来检索信息。不过这个数据库也不是实时更新的，系统会使用定时任务每天自动执行 `updatedb` 命令来更新数据库。所以有时候你刚添加的文件，它可能会找不到，需要手动执行一次 `updatedb` 命令（在我们的环境中必须先执行一次该命令）。注意这个命令也不是内置的命令，在部分环境中需要手动安装，然后执行更新。

```bash
sudo apt-get update
sudo apt-get install locate
sudo updatedb
```

它可以用来查找指定目录下的不同文件类型，如查找 `/etc` 下所有以 sh 开头的文件：

```bash
locate /etc/sh
```

查找 `/usr/share/` 下所有 jpg 文件：

```bash
locate /usr/share/\*.jpg
```

| 命令 | 说明               |
| ---- | ------------------ |
| `-b` | 只搜索二进制文件   |
| `-m` | 只搜索man 帮助文件 |
| `-s` | 只搜索源代码文件   |
| `-c` | 统计数目           |
| `-i` | 忽略大小写进行搜索 |

#### which小而精

`which` 本身是 Shell 内建的一个命令，我们通常使用 `which` 来确定是否安装了某个指定的程序，因为它只从 `PATH` 环境变量指定的路径中去搜索命令并且返回第一个搜索到的结果。也就是说，我们可以看到某个系统命令是否存在以及执行的到底是哪一个地方的命令。 

 ``` bash
which man
which nginx
which ping
 ```



#### find精而细

`find` 应该是这几个命令中最强大的了，它不但可以通过文件类型、文件名进行查找而且可以根据文件的属性（如文件的时间戳，文件的权限等）进行搜索。 

基本命令格式为 `find [path] [option] [action]`  

| 参数     | 说明                   |
| -------- | ---------------------- |
| `-atime` | 最后访问时间           |
| `-ctime` | 最后修改文件内容的时间 |
| `-mtime` | 最后修改文件属性的时间 |
| `-name`  | 按目录或文件名搜索     |

下面以 `-mtime` 参数举例：

- `-mtime n`：n 为数字，表示为在 n 天之前的“一天之内”修改过的文件
- `-mtime +n`：列出在 n 天之前（不包含 n 天本身）被修改过的文件
- `-mtime -n`：列出在 n 天之内（包含 n 天本身）被修改过的文件
- `-newer file`：file 为一个已存在的文件，列出比 file 还要新的文件名

列出 home 目录中，当天（24 小时之内）有改动的文件：

```bash
find ~ -mtime 0
```

列出用户家目录下比 /etc 目录新的文件：

```bash
find ~ -newer /etc
```

这条命令表示去 `/etc/` 目录下面 ，搜索名字叫做 interfaces 的文件或者目录。这是 `find` 命令最常见的格式，千万记住 `find` 的第一个参数是要搜索的地方。命令前面加上 `sudo` 是因为 shiyanlou 只是普通用户，对 `/etc` 目录下的很多文件都没有访问的权限，如果是 root 用户则不用使用。 

```bash
sudo find /etc/ -name interfaces
```

### 压缩文件

使用 zip 打包文件夹

``` bash
zip -r -1 -q -o shiyanlou_1.zip /home/shiyanlou/Desktop -x ~/*.zip
```

| 参数 | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| `-r` | 递归打包包含子目录的全部内容                                 |
| `-1` | 设置压缩级别，1 表示最快压缩但体积大，9 表示体积最小但耗时最久 |
| `-q` | 表示为安静模式，即不向屏幕输出信息                           |
| `-o` | 表示输出文件，需在其后紧跟打包输出文件名                     |
| `-x` | 排除指定文件，不将指定文件打包进压缩文件，这里只能使用绝对路径，否则不起作用 |

查看文件信息

``` bash
du -h -d 0 *.zip ~ | sort
```

| 参数   | 说明                   |
| ------ | ---------------------- |
| `-h`   | 显示文件大小单位       |
| `-d 0` | 查询文件深度，目录级别 |
|        |                        |
|        |                        |

